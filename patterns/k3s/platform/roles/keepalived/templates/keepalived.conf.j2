! Keepalived configuration for K3s Ingress HA
! Generated by Ansible for {{ inventory_hostname }}

global_defs {
    router_id K3S_INGRESS_{{ inventory_hostname }}
    script_user root
    enable_script_security
}

vrrp_script check_ingress {
    script "/etc/keepalived/check_ingress.sh"
    interval 3
    weight -20
    fall 3
    rise 2
}

vrrp_instance K3S_INGRESS {
    state {{ vrrp_state }}
    interface {{ vrrp_interface }}
    virtual_router_id 51
    priority {{ vrrp_priority }}
    advert_int 1
    
    authentication {
        auth_type PASS
        auth_pass k3singress
    }
    
    track_script {
        check_ingress
    }
    
    # Notify scripts for logging state changes
    notify_master "/bin/echo 'VRRP: {{ inventory_hostname }} became MASTER' | logger -t keepalived"
    notify_backup "/bin/echo 'VRRP: {{ inventory_hostname }} became BACKUP' | logger -t keepalived"
    notify_fault "/bin/echo 'VRRP: {{ inventory_hostname }} entered FAULT state' | logger -t keepalived"
}
